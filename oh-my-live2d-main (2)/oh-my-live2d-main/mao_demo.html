<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mao Demo - Workspace</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <a href="chat_interface.html" class="chat-link-btn" target="_blank" title="进入对话">
    <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
  </a>

  <div class="demo-layout">
    <!-- Left Stage: Character Area -->
    <div class="left-stage">
      <h2 class="character-title">滴哇老师</h2>
      <div id="oml2d-container"></div>
      <div class="character-info" style="margin-top: 24px;">
        <p>上传乐谱，开始你的练习</p>
        <p>点击上方按钮进入对话模式</p>
      </div>
    </div>

    <!-- Right Stage: PDF Workspace -->
    <div class="right-pdf">
      <div class="pdf-header">
        <div class="upload-btn">
          <input type="file" id="pdfUpload" accept=".pdf" />
          <svg class="icon" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
          上传乐谱
        </div>
        <div class="pdf-hint">支持 PDF 格式文件</div>
        <div class="pdf-name" id="pdfName"></div>
      </div>

      <div class="pdf-viewer-wrap">
        <iframe id="pdfFrame"></iframe>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="packages/oh-my-live2d/dist/index.min.js"></script>
  <script>
    // Initialize Live2D
    // Use window.OML2D or Oml2d depending on library export, keeping safety check
    const loadLive2D = () => {
      const OML = window.OML2D || window.Oml2d;
      if (OML) {
        OML.loadOml2d({
          models: [
            {
              path: 'mao_pro_en/runtime/mao_pro.model3.json',
              scale: 0.1,
              position: [0, 0],
              stageStyle: {
                height: 400
              }
            }
          ],
          parentElement: document.getElementById('oml2d-container'),
          primaryColor: '#0B57D0',
          sayHello: false,
          tips: {
            style: {
              width: 230,
              height: 120,
              left: 'calc(50% - 20px)',
              top: -140,
            },
            idleTips: {
              word: ['这里是乐谱预览区，快去上传乐谱吧~', '点击左上角可以进入对话练习哦~', '我是滴哇老师，随时为你服务喵~']
            }
          }
        });
      }
    };
    loadLive2D();

    // PDF Upload Logic
    const pdfUpload = document.getElementById('pdfUpload');
    const pdfFrame = document.getElementById('pdfFrame');
    const pdfName = document.getElementById('pdfName');

    pdfUpload.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      if (file.type !== 'application/pdf') {
        alert('请上传 PDF 文件');
        return;
      }

      pdfName.textContent = file.name;
      const fileURL = URL.createObjectURL(file);
      pdfFrame.src = fileURL;
    });
  </script>
</body>
</html>
