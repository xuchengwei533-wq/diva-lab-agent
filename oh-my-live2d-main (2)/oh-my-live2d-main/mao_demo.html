<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mao-demo</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #f5f7fb;
      font-family: Arial, sans-serif;
    }

    /* ===== é¡µé¢ä¸¤æ å¸ƒå±€ï¼šå·¦ä¾§ç»™å°äººç•™ç©ºé—´ï¼Œå³ä¾§æ˜¾ç¤º PDF ===== */
    .layout {
      display: flex;
      width: 100%;
      height: 100%;
    }

    .left-stage {
      flex: 0 0 40%;
      position: relative;
      height: 100%;
      background: transparent;
      overflow: hidden;
    }

    .right-pdf {
      flex: 1;
      height: 100%;
      background: #ffffff;
      border-left: 1px solid rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
    }

    /* ===== å³ä¾§é¡¶éƒ¨ï¼šä¸Šä¼ åŒº ===== */
    .pdf-header {
      flex: 0 0 auto;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      background: linear-gradient(180deg, #ffffff, #fafafa);
    }

    .upload-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #2b6ef3;
      color: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      user-select: none;
    }

    .upload-btn:hover {
      filter: brightness(0.95);
    }

    .upload-btn input {
      display: none;
    }

    .pdf-hint {
      color: #555;
      font-size: 13px;
    }

    .pdf-name {
      margin-left: auto;
      color: #222;
      font-size: 13px;
      max-width: 45%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ===== PDF é¢„è§ˆåŒºåŸŸ ===== */
    .pdf-viewer-wrap {
      flex: 1;
      position: relative;
      background: #fff;
    }

    iframe#pdfFrame {
      width: 100%;
      height: 100%;
      border: none;
      background: #fff;
    }

    /* ===== å°äººå®¹å™¨ï¼ˆæ”¾åœ¨å·¦ä¾§åŒºåŸŸå†…ï¼‰===== */
    #oml2d-container {
      position: absolute;   /* è®©å®ƒåœ¨å·¦ä¾§åŒºåŸŸå†…å®šä½ */
      left: 10px;
      bottom: 10px;
      z-index: 9999;
      pointer-events: auto;
    }

    /* å¯é€‰ï¼šè®© hit area çº¢æ¡†ä¸è‡³äºå¤ªåˆºçœ¼ */
    /* .oml2d-hit-area-frame { opacity: 0.6; } */

    /* å¯¹è¯æŒ‰é’®æ ·å¼ */
    .chat-link-btn {
      position: fixed;
      top: 14px;
      left: 14px;
      z-index: 10000;
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: #fff;
      padding: 8px 14px;
      border-radius: 18px;
      text-decoration: none;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      user-select: none;
    }
    .chat-link-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 14px rgba(0,0,0,0.30);
    }
  </style>
</head>

<body>
  <a href="chat_interface.html" class="chat-link-btn" target="_blank">
    å¯¹è¯ç•Œé¢
  </a>

  <div class="layout">
    <!-- å·¦ä¾§ï¼šå°äººåŒºåŸŸ -->
    <div class="left-stage">
      <!-- è½½å…¥ live2d -->
      <script src="packages/oh-my-live2d/dist/index.min.js"></script>
    </div>

    <!-- å³ä¾§ï¼šPDF æ•™æ¡ˆæ˜¾ç¤ºåŒºåŸŸ -->
    <div class="right-pdf">
      <div class="pdf-header">
        <label class="upload-btn">
          ğŸ“„ è¯·ä¸Šä¼ ä½ çš„ PDF æ•™æ¡ˆ
          <input id="pdfInput" type="file" accept="application/pdf" />
        </label>

        <div class="pdf-hint">ä¸Šä¼ åå°†ç›´æ¥åœ¨å³ä¾§é¢„è§ˆï¼ˆæ”¯æŒæ»šåŠ¨/ç¼©æ”¾ï¼‰ã€‚</div>
        <div class="pdf-name" id="pdfName">æœªé€‰æ‹©æ–‡ä»¶</div>
      </div>

      <div class="pdf-viewer-wrap">
        <!-- é»˜è®¤ç©ºç™½ï¼Œå¯æ›¿æ¢æˆæç¤ºé¡µ -->
        <iframe id="pdfFrame" title="PDF Viewer"></iframe>
      </div>
    </div>
  </div>

  <script>
    // ====== 1) åˆå§‹åŒ– Live2Dï¼ˆåŸºæœ¬æ²¿ç”¨ä½ åŸæ¥çš„é…ç½®ï¼‰ ======
    const oml2d = OML2D.loadOml2d({
      importType: 'cubism5',
      models: [
        {
          path: 'mao_pro_en/runtime/mao_pro.model3.json',
          scale: 0.10,
          position: [0, 0],
          showHitAreaFrames: true,
          motionPreloadStrategy: 'ALL'
        }
      ],
      debug: true,
      tips: {
        welcomeTips: { duration: 0, priority: 0 },
        idleTips: { duration: 0, priority: 0 }
      }
    });

    oml2d.onStageSlideIn(() => {
      console.log('mao æ¨¡å‹åŠ è½½æˆåŠŸ');
    });

    // ====== 2) PDF ä¸Šä¼  + é¡µé¢å†…é¢„è§ˆ ======
    const input = document.getElementById('pdfInput');
    const frame = document.getElementById('pdfFrame');
    const nameEl = document.getElementById('pdfName');

    let currentObjectUrl = null;

    input.addEventListener('change', () => {
      const file = input.files && input.files[0];
      if (!file) return;

      if (file.type !== 'application/pdf') {
        alert('è¯·é€‰æ‹© PDF æ–‡ä»¶ã€‚');
        input.value = '';
        return;
      }

      // é‡Šæ”¾æ—§çš„ URLï¼Œé¿å…å†…å­˜æ³„æ¼
      if (currentObjectUrl) {
        URL.revokeObjectURL(currentObjectUrl);
        currentObjectUrl = null;
      }

      currentObjectUrl = URL.createObjectURL(file);
      nameEl.textContent = file.name;

      // ä¸€äº›æµè§ˆå™¨æ”¯æŒ PDF å†…ç½®æŸ¥çœ‹å™¨ï¼›åŠ  #toolbar ç­‰å‚æ•°å¯æ§åˆ¶æ˜¾ç¤º
      frame.src = currentObjectUrl + '#toolbar=1&navpanes=0&view=FitH';
    });

    // å¯é€‰ï¼šç¦»å¼€é¡µé¢æ—¶é‡Šæ”¾ URL
    window.addEventListener('beforeunload', () => {
      if (currentObjectUrl) URL.revokeObjectURL(currentObjectUrl);
    });
  </script>
</body>
</html>
